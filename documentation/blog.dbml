// Blog schema tailored for PostgreSQL
// Notes: uses `uuid` for IDs (Postgres `gen_random_uuid()`), `timestamp` for timestamps,
// `jsonb` for metadata, `citext` for case-insensitive email (enable extension),
// and a `tsvector` `search` column on `posts` for full-text search (create GIN index).

Table users {
  id uuid [pk, default: `gen_random_uuid()`]
  email citext [unique, not null]
  password_hash text [not null]
  display_name text
  bio text
  metadata jsonb
  created_at timestamp [default: `now()`]
  updated_at timestamp
  deleted_at timestamp
}

Table categories {
  id uuid [pk, default: `gen_random_uuid()`]
  name text [not null]
  slug text [unique, not null]
  description text
  created_at timestamp [default: `now()`]
}

Table posts {
  id uuid [pk, default: `gen_random_uuid()`]
  author_id uuid [ref: > users.id, not null]
  category_id uuid [ref: > categories.id]
  title text [not null]
  slug text [unique, not null]
  content text
  excerpt text
  status varchar(20) [not null, default: 'draft']
  published_at timestamp
  metadata jsonb
  search tsvector
  created_at timestamp [default: `now()`]
  updated_at timestamp
  deleted_at timestamp
}

Table tags {
  id uuid [pk, default: `gen_random_uuid()`]
  name text [not null]
  slug text [unique, not null]
  created_at timestamp [default: `now()`]
}

Table post_tags {
  post_id uuid [ref: > posts.id, not null]
  tag_id uuid [ref: > tags.id, not null]
  created_at timestamp [default: `now()`]
  // composite unique constraint on (post_id, tag_id)
}

Table comments {
  id uuid [pk, default: `gen_random_uuid()`]
  post_id uuid [ref: > posts.id, not null]
  author_id uuid [ref: > users.id]
  parent_id uuid [ref: > comments.id]
  body text [not null]
  created_at timestamp [default: `now()`]
  deleted_at timestamp
}

Table attachments {
  id uuid [pk, default: `gen_random_uuid()`]
  post_id uuid [ref: > posts.id]
  uploader_id uuid [ref: > users.id]
  url text [not null]
  type varchar(50)
  alt_text text
  metadata jsonb
  created_at timestamp [default: `now()`]
}

Table revisions {
  id uuid [pk, default: `gen_random_uuid()`]
  post_id uuid [ref: > posts.id, not null]
  editor_id uuid [ref: > users.id]
  title text
  content text
  created_at timestamp [default: `now()`]
}

Table likes {
  id uuid [pk, default: `gen_random_uuid()`]
  user_id uuid [ref: > users.id, not null]
  target_type varchar(50) [not null] // e.g. 'post' | 'comment'
  target_id uuid [not null]
  created_at timestamp [default: `now()`]
  // Consider a partial unique constraint (user_id, target_type, target_id)
}

// Note: inline `ref:` annotations are used above; explicit `Ref:` lines removed to avoid duplicates.
/*
Postgres-specific implementation notes (apply after DB creation):
 - Enable extensions: citext, pg_trgm, and pgcrypto (for `gen_random_uuid()`) or uuid-ossp (for `uuid_generate_v4()`)
 - Create GIN index for full-text search: CREATE INDEX posts_search_gin ON posts USING GIN(search);
 - Populate `search` via GENERATED STORED column or trigger: to_tsvector('english', coalesce(title,'') || ' ' || coalesce(content,''))
 - Create GIN index on jsonb metadata for queries: CREATE INDEX ON posts USING GIN(metadata);
 - Create partial indexes to speed up active rows: e.g. CREATE INDEX ON posts(created_at) WHERE deleted_at IS NULL;
 - Set ON DELETE behavior per FK depending on app logic (e.g., ON DELETE SET NULL for authors).
*/
